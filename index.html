<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fill and Sign BIR2316 Form</title>
    <style>
        #signaturePadCanvas {
            border: 1px solid black;
            width: 300px;
            height: 100px;
        }
    </style>
</head>
<body>
    <h1>Fill and Sign BIR2316 Form</h1>

    <label for="ctcNo">CTC/Valid ID No:</label>
    <input type="text" id="ctcNo"><br>

    <label for="placeOfIssue">Place of Issue:</label>
    <input type="text" id="placeOfIssue"><br>

    <label for="dateSigned">Date Signed:</label>
    <input type="date" id="dateSigned"><br>

    <label for="dateIssued">Date Issued:</label>
    <input type="date" id="dateIssued"><br>

    <div id="signaturePad">
        <canvas id="signaturePadCanvas"></canvas><br>
        <button id="clearSignature">Clear Signature</button>
    </div>

    <button id="saveForm">Save and Download Form</button>

    <script>
        const pdfUrl = 'BIR2316.pdf'; // Replace with the path to your PDF template file
        const signaturePad = new SignaturePad(document.getElementById('signaturePadCanvas'));

        document.getElementById('clearSignature').addEventListener('click', () => {
            signaturePad.clear();
        });

        async function loadPdfTemplate() {
            const pdfBytes = await fetch(pdfUrl).then(res => res.arrayBuffer());
            const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
            const form = pdfDoc.getForm();

            // Retrieve the form fields by name and populate them
            form.getTextField('CTCNo').setText(document.getElementById('ctcNo').value);
            form.getTextField('PlaceOfIssue').setText(document.getElementById('placeOfIssue').value);
            form.getTextField('DateSigned').setText(document.getElementById('dateSigned').value);
            form.getTextField('DateIssued').setText(document.getElementById('dateIssued').value);

            // Embed the signature
            if (!signaturePad.isEmpty()) {
                const signatureImage = signaturePad.toDataURL();
                const pngImageBytes = await fetch(signatureImage).then(res => res.arrayBuffer());
                const pngImage = await pdfDoc.embedPng(pngImageBytes);
                const pages = pdfDoc.getPages();
                const firstPage = pages[0];

                // Adjust position and size of the signature as needed
                firstPage.drawImage(pngImage, {
                    x: 350,
                    y: 120, // Position on the PDF page
                    width: 150,
                    height: 50,
                });
            }

            // Save and download the completed PDF
            const pdfBytesOutput = await pdfDoc.save();
            const blob = new Blob([pdfBytesOutput], { type: 'application/pdf' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'BIR2316_Filled.pdf';
            link.click();
        }

        document.getElementById('saveForm').addEventListener('click', loadPdfTemplate);
    </script>
</body>
</html>
